---
title: JavaScript30-Day20-å³æ™‚èªéŸ³è¾¨è­˜
date: 2018-08-14 22:01:24
categories: JavaScript30
tags:
  - JavaScript30
  - JavaScript
  - Speech Recongnition
---

# 20 - Speech Detection

## ç­†è¨˜

[DEMO](https://weiyuan1993.github.io/JavaScript30/20-Speech-Detection)
[GitHub](https://github.com/weiyuan1993/JavaScript30/tree/master/20-Speech-Detection)

ç”¨ JS æ“ä½œèªéŸ³è¾¨è­˜ï¼Œä¸¦å³æ™‚è¼¸å‡ºæ–‡å­—!

<!--more-->

## ä½œæ³•

### æ–°å»ºèªéŸ³è¾¨è­˜

èªéŸ³è¾¨è­˜ç‚ºç€è¦½å™¨å…§å»ºï¼Œä½†ç›®å‰ä¼¼ä¹åªæœ‰ Chrome æ”¯æ´ã€‚

```javascript
// æ–°å»ºèªéŸ³è¾¨è­˜
const speechRecongnition = new SpeechRecognition();
// æ§åˆ¶æ˜¯å¦å³æ™‚å›å‚³
speechRecongnition.interimResults = true;
// èªè¨€
speechRecongnition.lang = "zh-TW";
```

èªè¨€æ²’è¨­å®šçš„è©±é è¨­æ‡‰è©²æ˜¯ç€è¦½å™¨èªè¨€ï¼Œæ‰€ä»¥æˆ‘å¾Œä¾†åšäº†æŒ‰éˆ•å¯ä»¥åˆ‡æ›åˆ°è‹±æ–‡ï¼Œå› ç‚ºåœ¨ä¸­æ–‡çš„è¾¨è¦–ä¸‹è¬›è‹±æ–‡è¾¨è­˜ç‡è¼ƒä½ã€‚

### å…ˆè¨­å®šå¥½åˆå§‹æ–‡å­—

```javascript
let p = document.createElement("p");
p.textContent = "è«‹é–‹å§‹èªªè©± ğŸ—£";
const words = document.querySelector(".words");
words.appendChild(p);
```

### è¼¸å‡ºè¾¨è­˜å…§å®¹

```javascript
speechRecongnition.addEventListener("result", e => {
  // é€™é‚Šç‚ºäº†å–å¾—å›å‚³çš„çµæœï¼Œä¸¦å°‡æ‰€æœ‰è¾¨è­˜çš„æ–‡å­—ä¸²åœ¨ä¸€èµ·
  const transcript = Array.from(e.results)
    .map(result => result[0])
    .map(result => result.transcript)
    .join("");
  // é€™é‚Šå¯ä»¥æ¿¾æ‰é«’è©±XD
  const filterBadLang = transcript.replace(/å¹¹ä½ å¨˜|é åŒ—|æ“ä½ åª½/gi, "ğŸ’©");
  p.textContent = filterBadLang;

  // ç›£æ¸¬æ˜¯å¦è¾¨è­˜åœæ­¢ï¼Œåœæ­¢å¾Œæ–°å¢æ–°çš„ p ç‚ºä¸‹ä¸€å¥åšæº–å‚™ä¾†é”åˆ°æ›è¡Œæ•ˆæœ
  if (e.results[0].isFinal) {
    p = document.createElement("p");
    words.appendChild(p);
  }
});
```

è¾¨è­˜çš„é€”ä¸­å¯ä»¥åšä¸€äº›å°é‹ç”¨ï¼Œæ¯”å¦‚è½åˆ°ä¸€äº›é—œéµå­—å¯ä»¥å±è”½æ‰ï¼Œæˆ–è€…æ˜¯ç•¶ä½œèªéŸ³åŠ©ç†ï¼Œå›æ‡‰å…§å®¹ï¼ŒæŸ¥å¤©æ°£ç­‰ç­‰ã€‚

### è¾¨è­˜å•Ÿå‹•

```javascript
speechRecongnition.addEventListener("end", speechRecongnition.start);
speechRecongnition.start();
```

ç‚ºäº†è®“è¾¨è­˜å¯ä»¥ä¸€ç›´å•Ÿå‹•ï¼Œæ‰€ä»¥åœ¨ end è§¸ç™¼æ™‚å†æ¬¡è§¸ç™¼ startã€‚
